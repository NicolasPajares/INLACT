<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ensayo t√©cnico | INLACT</title>

  <!-- SEO / Mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS principal (EL MISMO DEL INDEX) -->
  <link rel="stylesheet" href="index.css">

  <style>
    /* SOLO estilos propios del ensayo */

    body {
      background: #f4f6f8;
    }

    .ensayo {
      max-width: 900px;
      margin: 30px auto 60px;
      background: #ffffff;
      border-radius: 18px;
      padding: 40px 36px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }

    .ensayo h1 {
      text-align: center;
      color: #1f4e8c;
      margin-bottom: 6px;
    }

    .ensayo h2 {
      text-align: center;
      font-weight: 500;
      color: #374151;
      margin-bottom: 40px;
    }

    .bloque {
      margin-bottom: 32px;
    }

    .bloque h3 {
      margin-bottom: 8px;
      color: #1f2937;
      font-size: 16px;
      border-left: 4px solid #1f4e8c;
      padding-left: 10px;
    }

    .bloque p {
      margin: 0;
      line-height: 1.6;
      color: #374151;
      white-space: pre-line;
    }

    /* BOT√ìN MEDIA */
    .btn-media {
      background: #1f4e8c;
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
    }

    .btn-media:hover {
      background: #163b6a;
    }

    /* MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal-contenido {
      background: #fff;
      max-width: 950px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
      border-radius: 18px;
      position: relative;
    }

    .modal-cerrar {
      position: absolute;
      top: 14px;
      right: 14px;
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
    }

    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 20px;
    }

    .media-grid img,
    .media-grid video {
      width: 100%;
      border-radius: 12px;
    }

    .oculto {
      display: none;
    }
  </style>
</head>

<body>

<!-- HEADER IGUAL AL INDEX -->
<header>
  <figure>
    <img src="img/logo.jpg" alt="INLACT">
  </figure>
  <h2>NICOL√ÅS PAJARES</h2>
</header>

<main>

  <section class="ensayo">
    <h1 id="tituloEnsayo">Ensayo t√©cnico</h1>
    <h2 id="subtituloEnsayo"></h2>

    <div id="contenido"></div>

    <!-- BOT√ìN MEDIA -->
    <div id="bloqueMedia" class="bloque oculto">
      <button id="btnVerMedia" class="btn-media">
        üì∑ Ver im√°genes y videos del ensayo
      </button>
    </div>
  </section>

</main>

<!-- MODAL -->
<div id="modalMedia" class="modal oculto">
  <div class="modal-contenido">
    <button class="modal-cerrar" id="cerrarModal">‚úñ</button>
    <h3>Registro del ensayo</h3>
    <div id="mediaContainer" class="media-grid"></div>
  </div>
</div>

<!-- FOOTER ID√âNTICO AL INDEX -->
<footer>
  <p>¬© INLACT ¬∑ <a href="aviso-legal.html">Aviso Legal</a></p>
</footer>

<script type="module">
/**********************
 * FIREBASE
 **********************/
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCpCO82XE8I990mWw4Fe8EVwmUOAeLZdv4",
  authDomain: "inlact.firebaseapp.com",
  projectId: "inlact",
  storageBucket: "inlact.appspot.com",
  messagingSenderId: "143868382036",
  appId: "1:143868382036:web:b5af0e4faced7e880216c1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/**********************
 * CARGA ENSAYO
 **********************/
const params = new URLSearchParams(location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = "Ensayo no encontrado";
  throw new Error("ID faltante");
}

const ref = doc(db, "ensayos", id);
const snap = await getDoc(ref);

if (!snap.exists()) {
  document.body.innerHTML = "Ensayo inexistente";
  throw new Error("No existe");
}

const e = snap.data();

/**********************
 * FECHA
 **********************/
const fecha = e.fecha?.toDate
  ? e.fecha.toDate().toLocaleDateString("es-AR", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    })
  : "--/--/----";

/**********************
 * TITULOS
 **********************/
document.getElementById("tituloEnsayo").textContent =
  e.nombreEnsayo || "Ensayo t√©cnico";

document.getElementById("subtituloEnsayo").textContent =
  e.clienteNombre || "";

/**********************
 * CONTENIDO
 **********************/
const div = document.getElementById("contenido");

div.innerHTML = `
  <div class="bloque"><h3>Fecha</h3><p>${fecha}</p></div>

  <div class="bloque"><h3>Propuesta</h3><p>${e.propuesta || "-"}</p></div>
  <div class="bloque"><h3>Dosis</h3><p>${e.dosis || "-"}</p></div>
  <div class="bloque"><h3>Metodolog√≠a</h3><p>${e.metodologia || "-"}</p></div>
  <div class="bloque"><h3>Resultados</h3><p>${e.resultados || "-"}</p></div>
  <div class="bloque"><h3>Conclusi√≥n</h3><p>${e.conclusion || "-"}</p></div>

  ${
    e.propuestaComercial
      ? `<div class="bloque">
          <h3>Propuesta comercial</h3>
          <p>${e.propuestaComercial}</p>
        </div>`
      : ""
  }
`;

/**********************
 * MEDIA
 **********************/
const bloqueMedia = document.getElementById("bloqueMedia");
const btnVerMedia = document.getElementById("btnVerMedia");
const modal = document.getElementById("modalMedia");
const cerrarModal = document.getElementById("cerrarModal");
const mediaContainer = document.getElementById("mediaContainer");

const media = e.media || [];

if (media.length > 0) {
  bloqueMedia.classList.remove("oculto");

  media.forEach(m => {
    if (m.tipo === "imagen") {
      mediaContainer.innerHTML += `<img src="${m.url}">`;
    }
    if (m.tipo === "video") {
      mediaContainer.innerHTML += `<video src="${m.url}" controls></video>`;
    }
  });
}

btnVerMedia?.addEventListener("click", () => {
  modal.classList.remove("oculto");
});

cerrarModal.addEventListener("click", () => {
  modal.classList.add("oculto");
});

modal.addEventListener("click", ev => {
  if (ev.target === modal) modal.classList.add("oculto");
});
</script>

</body>
</html>
