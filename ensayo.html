<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ensayo INLACT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="index.css">

  <style>
    .ensayo {
      max-width: 800px;
      margin: auto;
      padding: 30px;
    }
    .ensayo h1 {
      color: #1f4e8c;
      text-align: center;
      margin-bottom: 10px;
    }
    .ensayo h2 {
      text-align: center;
      font-weight: 500;
      color: #374151;
      margin-bottom: 30px;
    }
    .bloque {
      margin-bottom: 20px;
    }
    .bloque h3 {
      margin-bottom: 6px;
      color: #374151;
    }
    .fotos {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap: 12px;
    }
    .fotos img {
      width: 100%;
      border-radius: 12px;
    }
  </style>
</head>

<body>

<main class="ensayo">
  <h1 id="tituloEnsayo">Ensayo técnico</h1>
  <h2 id="subtituloEnsayo"></h2>

  <div id="contenido"></div>
</main>

<script type="module">
/**********************
 * FIREBASE
 **********************/
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCpCO82XE8I990mWw4Fe8EVwmUOAeLZdv4",
  authDomain: "inlact.firebaseapp.com",
  projectId: "inlact",
  storageBucket: "inlact.appspot.com",
  messagingSenderId: "143868382036",
  appId: "1:143868382036:web:b5af0e4faced7e880216c1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/**********************
 * CARGA ENSAYO
 **********************/
const params = new URLSearchParams(location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = "Ensayo no encontrado";
  throw new Error("ID de ensayo faltante");
}

const ref = doc(db, "ensayos", id);
const snap = await getDoc(ref);

if (!snap.exists()) {
  document.body.innerHTML = "Ensayo no encontrado";
  throw new Error("Ensayo inexistente");
}

const e = snap.data();

/**********************
 * FECHA
 **********************/
const fecha = e.fecha?.toDate
  ? e.fecha.toDate().toLocaleDateString("es-AR", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    })
  : "--/--/----";

/**********************
 * TITULOS
 **********************/
document.getElementById("tituloEnsayo").textContent =
  e.nombreEnsayo || "Ensayo técnico";

document.getElementById("subtituloEnsayo").textContent =
  e.clienteNombre || "";

/**********************
 * CONTENIDO
 **********************/
const div = document.getElementById("contenido");

div.innerHTML = `
  <div class="bloque"><h3>Fecha</h3><p>${fecha}</p></div>

  <div class="bloque"><h3>Propuesta</h3><p>${e.propuesta || "-"}</p></div>
  <div class="bloque"><h3>Dosis</h3><p>${e.dosis || "-"}</p></div>
  <div class="bloque"><h3>Metodología</h3><p>${e.metodologia || "-"}</p></div>
  <div class="bloque"><h3>Resultados</h3><p>${e.resultados || "-"}</p></div>
  <div class="bloque"><h3>Conclusión</h3><p>${e.conclusion || "-"}</p></div>

  ${
    e.fotos && e.fotos.length
      ? `
      <div class="bloque">
        <h3>Registro fotográfico</h3>
        <div class="fotos">
          ${e.fotos.map(f => `<img src="${f}">`).join("")}
        </div>
      </div>
      `
      : ""
  }
`;
</script>

</body>
</html>
