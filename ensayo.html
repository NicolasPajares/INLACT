<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ensayo t√©cnico | INLACT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS principal -->
  <link rel="stylesheet" href="index.css">

  <!-- CSS espec√≠fico -->
  <link rel="stylesheet" href="ensayo.css">
</head>

<body>

<header>
  <figure>
    <img src="img/logo.jpg" alt="INLACT">
  </figure>
  <h2>NICOL√ÅS PAJARES</h2>
</header>

<main class="layout-ensayo">

  <!-- SIDEBAR -->
  <aside class="ensayo-menu">
    <button data-seccion="propuesta">üìã Propuesta</button>
    <button data-seccion="dosis">‚öóÔ∏è Dosis</button>
    <button data-seccion="evidencia">üì∑ Evidencia</button>
    <button data-seccion="conclusion">üí° Conclusi√≥n</button>
    <button data-seccion="comercial">üí≤ Propuesta comercial</button>
  </aside>

  <!-- CONTENIDO -->
  <section class="ensayo-contenido">

    <h1 id="clienteNombre"></h1>
    <h2 id="fechaEnsayo"></h2>
    <h3 id="tituloEnsayo"></h3>

    <div id="propuesta" class="bloque oculto"></div>
    <div id="dosis" class="bloque oculto"></div>

    <div id="evidencia" class="bloque oculto">
      <button class="btn-media">üì∑ Ver im√°genes y videos</button>
    </div>

    <div id="conclusion" class="bloque oculto"></div>
    <div id="comercial" class="bloque oculto propuesta-comercial"></div>

  </section>

</main>

<footer>
  <p>¬© INLACT ¬∑ <a href="aviso-legal.html">Aviso Legal</a></p>
</footer>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const params = new URLSearchParams(location.search);
const id = params.get("id");

if (!id) {
  location.href = "ensayos.html";
}

async function cargarEnsayo() {
  const ref = doc(db, "ensayos", id);
  const snap = await getDoc(ref);
  if (!snap.exists()) {
    location.href = "ensayos.html";
    return;
  }

  const e = snap.data();

  document.getElementById("clienteNombre").textContent = e.clienteNombre || "";
  document.getElementById("fechaEnsayo").textContent =
    e.fecha?.toDate().toLocaleDateString("es-AR", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    }) || "";

  document.getElementById("tituloEnsayo").textContent = e.nombreEnsayo || "";

  function cargarSeccion(id, titulo, contenido) {
    if (!contenido) return;
    const div = document.getElementById(id);
    div.classList.remove("oculto");
    div.innerHTML = `<h4>${titulo}</h4><p>${contenido}</p>`;
  }

  cargarSeccion("propuesta", "Propuesta", e.propuesta);
  cargarSeccion("dosis", "Dosis", e.dosis);
  cargarSeccion("conclusion", "Conclusi√≥n", e.conclusion);

  if (e.propuestaComercial) {
    const com = document.getElementById("comercial");
    com.classList.remove("oculto");
    com.innerHTML = `
      <h4>Propuesta comercial</h4>
      <p>${e.propuestaComercial}</p>
    `;
  }

  if (e.fotos && e.fotos.length > 0) {
    const evid = document.getElementById("evidencia");
    evid.classList.remove("oculto");

    const btn = evid.querySelector(".btn-media");
    btn.onclick = () => {
      if (evid.querySelector(".galeria")) return;

      const gal = document.createElement("div");
      gal.className = "galeria";

      e.fotos.forEach(url => {
        if (url.match(/\.(mp4|webm|ogg)$/)) {
          const video = document.createElement("video");
          video.src = url;
          video.controls = true;
          gal.appendChild(video);
        } else {
          const img = document.createElement("img");
          img.src = url;
          gal.appendChild(img);
        }
      });

      evid.appendChild(gal);
    };
  }
}

cargarEnsayo();

document.querySelectorAll(".ensayo-menu button").forEach(btn => {
  btn.addEventListener("click", () => {
    const sec = btn.dataset.seccion;
    const el = document.getElementById(sec);
    if (el && !el.classList.contains("oculto")) {
      el.scrollIntoView({ behavior: "smooth" });
    }
  });
});
</script>

</body>
</html>
